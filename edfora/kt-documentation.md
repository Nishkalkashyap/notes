---
title : KT-documentation
description : KT-documentation
tags : []
sidebar : false
pageClass: hide-sagar
---

# KT-documentation

[[toc]]

## Notes on Mypat frontend

### How we webpack in Angular's build process
**Mypat frontend** is built on top of Angular 4, which does not has native support for injecting custom webpack config in the build process unlike Angular version 6+. We can use `ng eject` command to expose a custom webpack config but that comes with its own demerits. 

So to include webpack in our build process, we improvised and created our own way which works by modifying the `@angular/cli` package and changing angular's build scripts. 

To do this every time after a fresh `npm install` would be tedious, so we automated the process as follows:

1. We add a `postinstall` hook in our `package.json` file. This hook will run every time you run an `npm install` in the project.
2. In the `postinstall` hook we run a script that modifies the angular's native build config and injects the path to our custom webpack config. The script looks as follows:

    ```ts
    // ./scripts/generate-webpack-config.ts
    import * as  fs from 'fs';

    const WEBPACK_CONFIG_PATH = './node_modules/@angular/cli/models/webpack-config.js';
    const baseWebpackConfig = fs.readFileSync(WEBPACK_CONFIG_PATH).toString();

    const stringToReplace = 'this.config = webpackMerge(webpackConfigs);';
    const newString = 'this.config = webpackMerge(webpackConfigs.concat(require(path.join(process.cwd(), "./base-webpack.config.js"))));';

    if (baseWebpackConfig.indexOf(stringToReplace) !== -1) {
        console.log('Injecting custom webpack config in angular');
        const replacedFile = baseWebpackConfig.replace(stringToReplace, newString);
        fs.writeFileSync(WEBPACK_CONFIG_PATH, replacedFile);
        console.log('Successfully injected custom webpack config in angular');
    } else {
        console.log('Config already injected');
    }
    ```
3. No we can export a webpack config from the path `./base-webpack.config.js`, which will be included by angular in development as well as build time.

### How we add service worker
We add service worker in the website using the webpack plugin `workbox-webpack-plugin` in our webpack config. Mainly, we are using service worker for client side caching. Generating and using service worker works as follows:

1. At the build time, service worker and a precache manifest is generated by weback.
2. In the `main.ts` file of the project, we include the service worker as follows:
    ```ts
    // ./src/main.ts
    function addServiceWorker() {
    navigator.serviceWorker.register('/service-worker.js').then(registration => {
        console.log('SW registered: ', registration);
    }).catch(registrationError => {
        console.log('SW registration failed: ', registrationError);
    });
    }
    ```

### How we handle image compression
At the time of the build, we do lossy image compression to compress the size of images, this is again done using webpack. Check out the rest of the config here - `./base-webpack.config.js`

## Notes on cloudflare

### DNS resolver and the concept of DNS proxy
At its core, cloudflare is a reverse proxy. 
![](/edfora/cf-1.jpg)

